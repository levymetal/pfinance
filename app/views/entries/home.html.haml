= render 'form'

#category-overlay
  %input#category-name.big-button{:type => 'text', :autocorrect => 'off', :autocapitalize => 'off', :placeholder => 'Search'}

  %ul#category-list 

.month-stats.clearfix
  %h2 Past 30 Days
  
  #money-bar
    .i{:style => 'width: ' + ( number_to_percentage @income_total / (@income_total + @expenses_total) * 100 ) }
    .e{:style => 'width: ' + ( number_to_percentage @expenses_total / (@income_total + @expenses_total) * 100 ) }

  .income
    .average
      %span Per Day
      %span.num= number_format(@income_total / 30)
    .total
      %span Total
      %span.num= number_format @income_total
  .expenses
    .average
      %span Per Day
      %span.num= number_format(@expenses_total / 30)
    .total
      %span Total
      %span.num= number_format @expenses_total

#home-category-wrapper
  %ul#month-categories.month-list
    - @expense_entries_by_category.each do |category, entries|
      %li
        .clearfix.root-category
          .percentage-bar{ :style => 'width: ' + ( number_to_percentage ( entries.to_a.sum &:amount ) / @expenses_total * 100, precision: 0 ) }
          %h2.name= category.name
          %h3.percentage= number_to_percentage ( entries.to_a.sum &:amount ) / @expenses_total * 100, precision: 0
          %h3.total= number_format entries.to_a.sum &:amount
          %h3.day
            = number_format ( entries.to_a.sum &:amount ) / 30
            %span / day
          

        %ul
          - entries.group_by { |entry| entry.category }.sort_by { |category, entries| entries.to_a.sum &:amount }.reverse.each do |subcategory, subentries|
            %li
              .clearfix.sub-category
                .percentage-bar{ :style => 'width: ' + ( number_to_percentage ( subentries.to_a.sum &:amount ) / @expenses_total * 100, precision: 0 ) }
                %h2.name= subcategory.name
                %h3.percentage= number_to_percentage ( subentries.to_a.sum &:amount ) / @expenses_total * 100, precision: 0
                %h3.total= number_format subentries.to_a.sum &:amount
                %h3.day
                  = number_format ( subentries.to_a.sum &:amount ) / 30
                  %span / day
